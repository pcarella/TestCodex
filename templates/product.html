{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center mb-4">
  <div class="col-xl-10 col-xxl-9">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
      <div>
        <p class="text-uppercase text-muted fw-semibold mb-1 small">Scheda prodotto</p>
        <h1 class="h3 mb-1">Codice {{ product.code }}</h1>
        <p class="mb-0 text-secondary">Aggiorna le informazioni prima di confermare l'invio al PIM.</p>
        <nav aria-label="Percorso" class="small mt-1">
          <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="{{ url_for('results') }}">Risultati</a></li>
            <li class="breadcrumb-item active" aria-current="page">Codice {{ product.code }}</li>
          </ol>
        </nav>
      </div>
      <div class="d-flex align-items-center gap-3">
        <div class="badge rounded-pill text-bg-warning text-dark px-3 py-2 shadow-sm">Step 3/3 · In revisione</div>
        <a class="btn btn-outline-secondary" href="{{ url_for('results') }}">Torna ai risultati</a>
      </div>
    </div>
  </div>
</div>

<div class="row justify-content-center g-4">
  <div class="col-xl-4 col-xxl-3">
    <div class="card h-100 border-0 shadow-sm overflow-hidden">
      <div class="bg-warning-subtle px-4 py-3 border-bottom">
        <div class="d-flex align-items-start justify-content-between">
          <div>
            <p class="text-uppercase text-muted fw-semibold mb-1 small">Anteprima</p>
            <h2 class="h5 mb-0">{{ product.denominazione_vendita or 'Denominazione non disponibile' }}</h2>
            <p class="text-secondary mb-0">EAN: {{ product.codice_ean or '—' }}</p>
          </div>
          <div class="badge bg-white text-warning-emphasis border border-warning">Cod. {{ product.code }}</div>
        </div>
      </div>
      <div class="card-body d-flex flex-column gap-3">
        <div class="rounded-4 bg-body-secondary p-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="text-muted small">Categoria</span>
            {% if product.categories %}
            <span class="badge text-bg-light border">{{ product.categories[0].name }}</span>
            {% else %}
            <span class="badge text-bg-light border">—</span>
            {% endif %}
          </div>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="text-muted small">Prezzo</span>
            <div class="fw-semibold fs-5 text-success">€ {{ '%.2f'|format(product.price) }}</div>
          </div>
          <div class="text-muted small">Descrizione marketing</div>
          <p class="mb-0 fw-medium">{{ product.descrizione_marketing }}</p>
        </div>
        <div>
          <p class="text-muted text-uppercase small fw-semibold mb-2">Dettaglio</p>
          <p class="mb-0 text-body-secondary">Codici categoria disponibili:</p>
          <ul class="mb-0 small text-muted">
            {% for category in product.categories %}
            <li><strong>{{ category.code }}</strong> — {{ category.name }}</li>
            {% else %}
            <li>Nessuna categoria presente nella risposta.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-6 col-xxl-6">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white border-0 pb-0">
          <p class="text-uppercase text-muted fw-semibold mb-1 small">Modifica dati</p>
          <h2 class="h5 mb-0">Ottimizza le informazioni per il catalogo</h2>
        </div>
      <div class="card-body">
        <form method="post" class="row g-4">
          <div class="col-12">
            <label class="form-label fw-semibold" for="denominazione_vendita">Denominazione di vendita</label>
            <input type="text" class="form-control form-control-lg" id="denominazione_vendita" name="denominazione_vendita" value="{{ product.denominazione_vendita }}" required />
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold" for="price">Prezzo</label>
            <div class="input-group input-group-lg">
              <span class="input-group-text">€</span>
              <input type="number" step="0.01" class="form-control" id="price" name="price" value="{{ '%.2f'|format(product.price) }}" required />
            </div>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold" for="descrizione_marketing">Descrizione marketing</label>
            <textarea class="form-control" id="descrizione_marketing" name="descrizione_marketing" rows="4" required placeholder="Inserisci la descrizione marketing">{{ product.descrizione_marketing }}</textarea>
          </div>
          <div class="d-flex justify-content-between align-items-center pt-2">
            <div class="d-flex align-items-center gap-2 text-secondary">
              <div class="rounded-circle bg-warning-subtle text-warning-emphasis d-inline-flex align-items-center justify-content-center fw-bold" style="width: 34px; height: 34px;">
                ✓
              </div>
              <div>
                <div class="fw-semibold">Conferma necessaria</div>
                <small class="text-muted">Controlla i campi prima di inviare al PIM.</small>
              </div>
            </div>
            <div class="d-flex gap-3">
              <a class="btn btn-outline-secondary" href="{{ url_for('results') }}">Annulla</a>
              <button type="submit" class="btn btn-primary px-4" id="submit-product">
                <span class="spinner-border spinner-border-sm align-text-bottom me-2 d-none" role="status" aria-hidden="true"></span>
                <span class="submit-label">Invia al PIM</span>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script>
  (function () {
    const form = document.querySelector("form");
    const submitButton = document.getElementById("submit-product");
    const spinner = submitButton?.querySelector(".spinner-border");
    const label = submitButton?.querySelector(".submit-label");
    form?.addEventListener("submit", () => {
      submitButton.setAttribute("disabled", "disabled");
      spinner?.classList.remove("d-none");
      label.textContent = "Salvataggio in corso...";
    });
  })();
</script>
{% endblock %}
